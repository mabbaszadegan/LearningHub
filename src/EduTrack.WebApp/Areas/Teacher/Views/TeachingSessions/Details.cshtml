@model EduTrack.Application.Common.Models.TeachingSessionReportDto
@{
    ViewData["Title"] = "جزئیات جلسه آموزشی";
    var courseTitle = ViewBag.CourseTitle as string;
}

<!-- Page Header -->
<div class="page-header-minimal mb-3">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">جزئیات جلسه آموزشی</h1>
            <p class="page-subtitle mb-0">
                <a asp-controller="Courses" asp-action="Index" class="breadcrumb-link">
                    <i class="fas fa-chevron-right"></i> دوره‌ها
                </a>
                <span class="mx-2">/</span>
                <a asp-controller="TeachingPlan" asp-action="Index" asp-route-courseId="@ViewBag.CourseId" class="breadcrumb-link">
                    @courseTitle
                </a>
                <span class="mx-2">/</span>
                <a asp-action="Index" asp-route-planId="@Model.TeachingPlanId" class="breadcrumb-link">
                    جلسات آموزشی
                </a>
                <span class="mx-2">/</span>
                <span>@(Model.Title ?? "جلسه بدون عنوان")</span>
            </p>
        </div>
        <div class="header-actions">
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn-action-secondary">
                <i class="fas fa-edit"></i>
                <span>ویرایش</span>
            </a>
            <a asp-action="Index" asp-route-planId="@Model.TeachingPlanId" class="btn-action-primary">
                <i class="fas fa-arrow-right"></i>
                <span>بازگشت</span>
            </a>
        </div>
    </div>
</div>

<!-- Session Overview Cards -->
<div class="session-overview mb-4">
    <div class="overview-grid">
        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="overview-content">
                <h3>تاریخ جلسه</h3>
                <p class="overview-date">@Model.SessionDate.ToString("dd MMM yyyy")</p>
                <p class="overview-time">@Model.SessionDate.ToString("HH:mm")</p>
            </div>
        </div>

        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-video"></i>
            </div>
            <div class="overview-content">
                <h3>نوع جلسه</h3>
                <span class="mode-badge bg-@(Model.Mode == EduTrack.Domain.Enums.SessionMode.InPerson ? "primary" : Model.Mode == EduTrack.Domain.Enums.SessionMode.Online ? "success" : "warning")">
                    @(Model.Mode == EduTrack.Domain.Enums.SessionMode.InPerson ? "حضوری" : Model.Mode == EduTrack.Domain.Enums.SessionMode.Online ? "آنلاین" : "ترکیبی")
                </span>
            </div>
        </div>

        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="overview-content">
                <h3>حضور و غیاب</h3>
                <div class="attendance-stats">
                    <span class="stat-present">@Model.PresentCount حاضر</span>
                    <span class="stat-absent">@Model.AbsentCount غایب</span>
                </div>
                <p class="stat-total">@Model.AttendanceCount نفر کل</p>
            </div>
        </div>

        <div class="overview-card">
            <div class="overview-icon">
                <i class="fas fa-user-tie"></i>
            </div>
            <div class="overview-content">
                <h3>ایجاد شده توسط</h3>
                <p class="overview-teacher">@Model.CreatedByTeacherName</p>
                <p class="overview-date">@Model.CreatedAt.ToString("dd MMM yyyy")</p>
            </div>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.Location))
{
    <div class="location-info mb-4">
        <div class="location-card">
            <i class="fas fa-map-marker-alt"></i>
            <div>
                <h4>مکان برگزاری</h4>
                <p>@Model.Location</p>
            </div>
        </div>
    </div>
}

<!-- Session Content Tabs -->
<div class="session-tabs-container">
    <div class="tabs-header">
        <button class="tab-btn active" data-tab="summary">
            <i class="fas fa-info-circle"></i>
            <span>خلاصه جلسه</span>
        </button>
        <button class="tab-btn" data-tab="attendance">
            <i class="fas fa-users"></i>
            <span>حضور و غیاب</span>
        </button>
        <button class="tab-btn" data-tab="assignments">
            <i class="fas fa-tasks"></i>
            <span>ایجاد تکلیف</span>
        </button>
    </div>

    <div class="tabs-content">
        <!-- Summary Tab -->
        <div class="tab-panel active" id="summary">
            <div class="content-grid">
                <div class="content-card">
                    <div class="card-header">
                        <h4>
                            <i class="fas fa-list-ul"></i>
                            موضوعات تدریس شده
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="json-content">
                            <pre>@Model.TopicsJson</pre>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h4>
                            <i class="fas fa-chart-bar"></i>
                            آمار جلسه
                        </h4>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.StatsJson))
                        {
                            <div class="json-content">
                                <pre>@Model.StatsJson</pre>
                            </div>
                        }
                        else
                        {
                            <div class="empty-content">
                                <i class="fas fa-chart-line"></i>
                                <p>آمار جلسه ثبت نشده</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Model.Notes))
            {
                <div class="content-card full-width">
                    <div class="card-header">
                        <h4>
                            <i class="fas fa-sticky-note"></i>
                            یادداشت‌های جلسه
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="notes-content">
                            <p>@Model.Notes</p>
                        </div>
                    </div>
                </div>
            }

            @if (!string.IsNullOrEmpty(Model.AttachmentsJson))
            {
                <div class="content-card full-width">
                    <div class="card-header">
                        <h4>
                            <i class="fas fa-paperclip"></i>
                            ضمائم جلسه
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="json-content">
                            <pre>@Model.AttachmentsJson</pre>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Attendance Tab -->
        <div class="tab-panel" id="attendance">
            <div class="attendance-container">
                @if (Model.Attendance.Any())
                {
                    <div class="attendance-table">
                        <div class="table-header">
                            <h4>
                                <i class="fas fa-users"></i>
                                لیست حضور و غیاب
                            </h4>
                        </div>
                        <div class="table-content">
                            @foreach (var attendance in Model.Attendance)
                            {
                                <div class="attendance-row">
                                    <div class="student-info">
                                        <div class="student-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="student-details">
                                            <h5>@attendance.StudentName</h5>
                                        </div>
                                    </div>
                                    <div class="attendance-status">
                                        <span class="status-badge bg-@(attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Present ? "success" : 
                                                                        attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Absent ? "danger" : 
                                                                        attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Late ? "warning" : "info")">
                                            @(attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Present ? "حاضر" : 
                                              attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Absent ? "غایب" : 
                                              attendance.Status == EduTrack.Domain.Enums.AttendanceStatus.Late ? "تأخیر" : "معذور")
                                        </span>
                                    </div>
                                    <div class="participation-score">
                                        @if (attendance.ParticipationScore.HasValue)
                                        {
                                            <span class="score-badge">@attendance.ParticipationScore.Value.ToString("F1")</span>
                                        }
                                        else
                                        {
                                            <span class="no-score">-</span>
                                        }
                                    </div>
                                    <div class="attendance-comment">
                                        @if (!string.IsNullOrEmpty(attendance.Comment))
                                        {
                                            <p>@attendance.Comment</p>
                                        }
                                        else
                                        {
                                            <span class="no-comment">-</span>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>هنوز حضور و غیابی ثبت نشده</h3>
                        <p>پس از ثبت حضور و غیاب، اطلاعات در اینجا نمایش داده خواهد شد</p>
                    </div>
                }
            </div>
        </div>

        <!-- Assignments Tab -->
        <div class="tab-panel" id="assignments">
            <div class="assignments-container">
                <div class="assignment-card">
                    <div class="assignment-header">
                        <h4>
                            <i class="fas fa-tasks"></i>
                            ایجاد تکلیف از جلسه
                        </h4>
                        <p>بر اساس این جلسه آموزشی، تکالیف هدفمند برای دانش‌آموزان یا گروه‌های خاص ایجاد کنید</p>
                    </div>
                    <div class="assignment-actions">
                        <a asp-action="CreateScheduleItemFromReport" asp-route-reportId="@Model.Id" class="btn-create-assignment">
                            <i class="fas fa-plus"></i>
                            <span>ایجاد تکلیف جدید</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        /* Page Header */
        .btn-action-primary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.125rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.813rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }

        .btn-action-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .btn-action-secondary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.125rem;
            background: #6c757d;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.813rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }

        .btn-action-secondary:hover {
            background: #5a6268;
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Breadcrumb Link */
        .breadcrumb-link {
            color: #667eea;
            text-decoration: none;
            font-size: 0.813rem;
            transition: all 0.2s;
        }

        .breadcrumb-link:hover {
            color: #5a6fd8;
            text-decoration: underline;
        }

        /* Session Overview */
        .session-overview {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            padding: 1.5rem;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .overview-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .overview-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            font-size: 1.25rem;
        }

        .overview-content h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6c757d;
            margin: 0 0 0.5rem 0;
        }

        .overview-date {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .overview-time {
            font-size: 0.813rem;
            color: #6c757d;
            margin: 0;
        }

        .mode-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.813rem;
            font-weight: 500;
        }

        .attendance-stats {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .stat-present {
            color: #28a745;
            font-weight: 600;
            font-size: 0.813rem;
        }

        .stat-absent {
            color: #dc3545;
            font-weight: 600;
            font-size: 0.813rem;
        }

        .stat-total {
            font-size: 0.75rem;
            color: #6c757d;
            margin: 0;
        }

        .overview-teacher {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1a1a1a;
            margin: 0;
        }

        /* Location Info */
        .location-info {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            padding: 1.5rem;
        }

        .location-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }

        .location-card i {
            font-size: 1.5rem;
            color: #667eea;
        }

        .location-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.25rem 0;
        }

        .location-card p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0;
        }

        /* Session Tabs */
        .session-tabs-container {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .tab-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            background: none;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .tabs-content {
            padding: 2rem;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .content-card {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        .content-card.full-width {
            grid-column: 1 / -1;
        }

        .card-header {
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .card-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-header i {
            color: #667eea;
        }

        .card-body {
            padding: 1rem;
        }

        .json-content pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.813rem;
            line-height: 1.5;
            margin: 0;
            overflow-x: auto;
        }

        .empty-content {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        .empty-content i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        .notes-content p {
            font-size: 0.875rem;
            line-height: 1.6;
            color: #374151;
            margin: 0;
        }

        /* Attendance Table */
        .attendance-container {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }

        .table-header {
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .table-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .table-header i {
            color: #667eea;
        }

        .table-content {
            padding: 1rem;
        }

        .attendance-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 2fr;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border: 1px solid #e9ecef;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            color: #667eea;
        }

        .student-details h5 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .status-badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.813rem;
            font-weight: 500;
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            font-size: 0.813rem;
            font-weight: 600;
        }

        .no-score,
        .no-comment {
            color: #6c757d;
            font-style: italic;
        }

        .attendance-comment p {
            font-size: 0.813rem;
            color: #6c757d;
            margin: 0;
        }

        /* Assignments */
        .assignments-container {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            padding: 2rem;
        }

        .assignment-card {
            text-align: center;
        }

        .assignment-header h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .assignment-header i {
            color: #667eea;
        }

        .assignment-header p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0 0 1.5rem 0;
        }

        .btn-create-assignment {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-create-assignment:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            font-size: 3rem;
            color: #dee2e6;
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0;
        }

        /* Responsive */
        @@media (max-width: 767.98px) {
            .overview-grid {
                grid-template-columns: 1fr;
            }

            .header-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .tabs-header {
                flex-direction: column;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .attendance-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
                text-align: center;
            }

            .student-info {
                justify-content: center;
            }
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Tab functionality
            $('.tab-btn').on('click', function() {
                const tabId = $(this).data('tab');
                
                // Update active tab button
                $('.tab-btn').removeClass('active');
                $(this).addClass('active');
                
                // Show corresponding tab panel
                $('.tab-panel').removeClass('active');
                $(`#${tabId}`).addClass('active');
            });
        });
    </script>
}
