@using EduTrack.Application.Common.Models.TeachingSessions
@model List<TeachingSessionReportDto>
@{
    ViewData["Title"] = "داشبورد جلسات آموزشی";
}

<div class="header-actions">
            <a asp-controller="TeachingPlan" asp-action="Index" class="btn-action-secondary">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>پلن‌های آموزشی</span>
            </a>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="stats-grid mb-4">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-calendar-day"></i>
        </div>
        <div class="stat-content">
            <h3>@Model.Count(s => s.SessionDate.Date == DateTime.Today)</h3>
            <p>جلسات امروز</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-calendar-week"></i>
        </div>
        <div class="stat-content">
            <h3>@Model.Count(s => s.SessionDate >= DateTime.Today.AddDays(-(int)DateTime.Today.DayOfWeek))</h3>
            <p>جلسات این هفته</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>@Model.Sum(s => s.AttendanceCount)</h3>
            <p>کل دانش‌آموزان</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
            <h3>@(Model.Any() ? (Model.Sum(s => s.PresentCount) * 100 / Model.Sum(s => s.AttendanceCount)).ToString("F1") : "0")%</h3>
            <p>میانگین حضور</p>
        </div>
    </div>
</div>

<!-- Today's Sessions -->
<div class="dashboard-section mb-4">
    <div class="section-header">
        <h2>
            <i class="fas fa-calendar-day"></i>
            جلسات امروز
        </h2>
        <p>جلسات برنامه‌ریزی شده برای امروز</p>
    </div>
    
    @{
        var todaySessions = Model.Where(s => s.SessionDate.Date == DateTime.Today).OrderBy(s => s.SessionDate).ToList();
    }
    
    @if (todaySessions.Any())
    {
        <div class="sessions-list">
            @foreach (var session in todaySessions)
            {
                <div class="session-item">
                    <div class="session-time">
                        <span class="time">@session.SessionDate.ToString("HH:mm")</span>
                    </div>
                    <div class="session-info">
                        <h4>@(session.Title ?? "جلسه بدون عنوان")</h4>
                        <p class="session-plan">@session.TeachingPlanTitle</p>
                        <div class="session-meta">
                            <span class="mode-badge bg-@(session.Mode == EduTrack.Domain.Enums.SessionMode.InPerson ? "primary" : session.Mode == EduTrack.Domain.Enums.SessionMode.Online ? "success" : "warning")">
                                @(session.Mode == EduTrack.Domain.Enums.SessionMode.InPerson ? "حضوری" : session.Mode == EduTrack.Domain.Enums.SessionMode.Online ? "آنلاین" : "ترکیبی")
                            </span>
                            @if (!string.IsNullOrEmpty(session.Location))
                            {
                                <span class="location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    @session.Location
                                </span>
                            }
                        </div>
                    </div>
                    <div class="session-actions">
                        <a asp-action="Details" asp-route-id="@session.Id" class="btn-action-small">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a asp-action="Edit" asp-route-id="@session.Id" class="btn-action-small">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <h3>هیچ جلسه‌ای برای امروز برنامه‌ریزی نشده</h3>
            <p>جلسات امروز در اینجا نمایش داده خواهند شد</p>
        </div>
    }
</div>

<!-- Recent Sessions -->
<div class="dashboard-section">
    <div class="section-header">
        <h2>
            <i class="fas fa-history"></i>
            جلسات اخیر
        </h2>
        <p>آخرین جلسات برگزار شده</p>
    </div>
    
    @{
        var recentSessions = Model.Where(s => s.SessionDate < DateTime.Today).OrderByDescending(s => s.SessionDate).Take(5).ToList();
    }
    
    @if (recentSessions.Any())
    {
        <div class="recent-sessions-grid">
            @foreach (var session in recentSessions)
            {
                <div class="recent-session-card">
                    <div class="session-header">
                        <div class="session-date">
                            <span class="day">@session.SessionDate.ToString("dd")</span>
                            <span class="month">@session.SessionDate.ToString("MMM")</span>
                        </div>
                        <div class="session-time">
                            <i class="fas fa-clock"></i>
                            <span>@session.SessionDate.ToString("HH:mm")</span>
                        </div>
                    </div>
                    
                    <div class="session-content">
                        <h4>@(session.Title ?? "جلسه بدون عنوان")</h4>
                        <p class="session-plan">@session.TeachingPlanTitle</p>
                        
                        <div class="attendance-summary">
                            <div class="attendance-item">
                                <i class="fas fa-user-check"></i>
                                <span>@session.PresentCount حاضر</span>
                            </div>
                            <div class="attendance-item">
                                <i class="fas fa-user-times"></i>
                                <span>@session.AbsentCount غایب</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="session-footer">
                        <a asp-action="Details" asp-route-id="@session.Id" class="btn-view-details">
                            <i class="fas fa-eye"></i>
                            <span>مشاهده جزئیات</span>
                        </a>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-history"></i>
            </div>
            <h3>هنوز جلسه‌ای برگزار نشده</h3>
            <p>جلسات برگزار شده در اینجا نمایش داده خواهند شد</p>
        </div>
    }
</div>

@section Styles {
    <style>
        /* Page Header */
        .btn-action-primary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.125rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.813rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }

        .btn-action-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            color: white;
        }

        .btn-action-secondary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.125rem;
            background: #6c757d;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.813rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }

        .btn-action-secondary:hover {
            background: #5a6268;
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 1.5rem;
        }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0 0 0.25rem 0;
        }

        .stat-content p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0;
        }

        /* Dashboard Sections */
        .dashboard-section {
            background: white;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-header h2 i {
            color: #667eea;
        }

        .section-header p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0;
        }

        /* Today's Sessions */
        .sessions-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .session-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
        }

        .session-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .session-time {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }

        .session-time .time {
            font-size: 1.125rem;
            font-weight: 700;
            color: #667eea;
        }

        .session-info {
            flex: 1;
        }

        .session-info h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.25rem 0;
        }

        .session-plan {
            font-size: 0.813rem;
            color: #6c757d;
            margin: 0 0 0.5rem 0;
        }

        .session-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .mode-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .location {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.813rem;
            color: #6c757d;
        }

        .location i {
            color: #667eea;
        }

        .session-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-action-small {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 6px;
            text-decoration: none;
            transition: all 0.2s;
        }

        .btn-action-small:hover {
            background: #667eea;
            color: white;
        }

        /* Recent Sessions Grid */
        .recent-sessions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .recent-session-card {
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
            transition: all 0.2s;
        }

        .recent-session-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: #667eea;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e9ecef;
        }

        .session-date {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #667eea;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            min-width: 50px;
        }

        .session-date .day {
            font-size: 1.125rem;
            font-weight: 700;
            line-height: 1;
        }

        .session-date .month {
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .session-time {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.813rem;
            color: #6c757d;
        }

        .session-time i {
            color: #667eea;
        }

        .session-content {
            padding: 1rem;
        }

        .session-content h4 {
            font-size: 0.938rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.25rem 0;
        }

        .session-plan {
            font-size: 0.813rem;
            color: #6c757d;
            margin: 0 0 0.75rem 0;
        }

        .attendance-summary {
            display: flex;
            gap: 1rem;
        }

        .attendance-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: #6c757d;
        }

        .attendance-item i {
            font-size: 0.7rem;
        }

        .session-footer {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e9ecef;
        }

        .btn-view-details {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.813rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-view-details:hover {
            background: #667eea;
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            font-size: 3rem;
            color: #dee2e6;
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            font-size: 0.875rem;
            color: #6c757d;
            margin: 0;
        }

        /* Responsive */
        @@media (max-width: 767.98px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .header-actions {
                flex-direction: column;
                gap: 0.5rem;
            }

            .session-item {
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .session-meta {
                justify-content: center;
            }

            .recent-sessions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-refresh stats every 5 minutes
            setInterval(function() {
                location.reload();
            }, 300000);
        });
    </script>
}
