<link rel="stylesheet" href="~/css/areas/teacher/shared/audio-block.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/areas/teacher/shared/content-blocks.css" asp-append-version="true" />

@{
    var blockType = ViewData["BlockType"]?.ToString() ?? "audio";
    var isQuestionBlock = ViewData["IsQuestionBlock"]?.ToString() == "true";
    var blockTitle = isQuestionBlock ? "سوال صوتی" : "بلاک صوت";
    var uploadText = isQuestionBlock ? "فایل صوتی سوال را اینجا بکشید یا کلیک کنید" : "فایل صوتی را اینجا بکشید یا کلیک کنید";
    var questionText = isQuestionBlock ? "سوال مربوط به فایل صوتی را اینجا تایپ کنید..." : "";
}

<div class="content-block-template" data-type="@blockType">
    <div class="block-header">
        <div class="block-type">
            <i class="fas fa-microphone"></i>
            <span>@blockTitle</span>
        </div>
        @await Html.PartialAsync("_BlockActions")
    </div>
    <div class="block-content">
        @if (isQuestionBlock)
        {
            <div class="question-settings inline">
                <div class="settings-grid">
                    <div class="setting-item">
                        <label>امتیاز:</label>
                        <select class="form-select-sm" data-setting="points">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>میزان سختی:</label>
                        <select class="form-select-sm" data-setting="difficulty">
                            <option value="easy">آسان</option>
                            <option value="medium" selected>متوسط</option>
                            <option value="hard">سخت</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="checkbox-label">
                            <input type="checkbox" data-setting="isRequired" checked>
                            <span>اجباری</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="question-text-editor">
                <label>متن سوال:</label>
                <div class="rich-text-editor" contenteditable="true" data-placeholder="@questionText">
                    <!-- Rich text content will be here -->
                </div>
            </div>
        }
        
        <!-- Hidden file input for upload (triggered by icon button) -->
        <input type="file" accept="audio/*" class="file-input" data-action="audio-upload" style="display:none;">
        
        <div class="audio-preview" style="display: none;">
            <audio controls class="preview-audio">
                <source src="" type="audio/mpeg">
            </audio>
        </div>
        
        <div class="audio-recorder">
            <div class="recorder-header">
                <h5>ذخیره فایل صوتی به دو روش: ضبط یا آپلود</h5>
            </div>
            <div class="recorder-controls">
                <button type="button" class="btn-teacher btn-danger" data-action="start-recording">
                    <i class="fas fa-microphone"></i>
                    <span>شروع ضبط</span>
                </button>
                <button type="button" class="btn-teacher btn-secondary" data-action="stop-recording" disabled>
                    <i class="fas fa-stop"></i>
                    <span>توقف ضبط</span>
                </button>
                <button type="button" class="btn-teacher btn-success" data-action="play-recording" disabled>
                    <i class="fas fa-play"></i>
                    <span>پخش</span>
                </button>
                <button type="button" class="btn-teacher btn-secondary" data-action="upload-audio" title="آپلود فایل صوتی">
                    <i class="fas fa-file-audio"></i>
                    <span>آپلود</span>
                </button>
            </div>
            <div class="recorder-status">
                <span class="recording-status">آماده برای ضبط</span>
                <div class="recording-timer" style="display: none;">
                    <span class="timer-display">00:00</span>
                </div>
            </div>
        </div>
        
        <div class="audio-caption">
            <textarea placeholder="توضیحات فایل صوتی (اختیاری)" rows="2" data-caption="true"></textarea>
        </div>
        
        <div class="audio-settings">
            <div class="settings-grid">
                <div class="setting-item">
                    <label>مدل نمایش:</label>
                    <select class="form-select-sm" data-setting="displayMode">
                        <option value="player" selected>پلیر</option>
                        <option value="icon">آیکن</option>
                    </select>
                </div>
                <div class="setting-item" id="attachment-mode-setting" style="display: none;">
                    <label>حالت اتصال:</label>
                    <select class="form-select-sm" data-setting="attachmentMode">
                        <option value="independent" selected>مستقل</option>
                        <option value="attached">چسبیده به بلاک قبل</option>
                    </select>
                </div>
            </div>
        </div>
        
        @if (isQuestionBlock)
        {
            <div class="question-hint">
                <label>راهنمایی (اختیاری):</label>
                <textarea placeholder="راهنمایی برای دانش‌آموز..." rows="2" data-hint="true"></textarea>
            </div>
        }
    </div>
</div>

<script src="~/js/areas/teacher/shared/audio-block.js" asp-append-version="true"></script>
