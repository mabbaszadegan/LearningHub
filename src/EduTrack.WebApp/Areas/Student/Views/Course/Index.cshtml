@using EduTrack.Application.Common.Helpers
@model List<EduTrack.Application.Features.CourseEnrollment.DTOs.StudentCourseEnrollmentSummaryDto>
@{
    ViewData["Title"] = "دوره‌های من";
}

@section Styles {
    <link rel="stylesheet" href="~/css/areas/student/course/course-list.css" asp-append-version="true" />
}

<div class="content-container">
    <!-- Course List Container -->
    <div class="course-list-container">
        @if (Model.Any())
        {
            <div class="row">
                @foreach (var enrollment in Model)
                {
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="course-card" data-course-id="@enrollment.CourseId">
                            <div class="course-thumbnail">
                                @if (!string.IsNullOrEmpty(enrollment.CourseThumbnail))
                                {
                                    <img src="@enrollment.CourseThumbnail" alt="@enrollment.CourseTitle" class="img-fluid">
                                }
                                else
                                {
                                    <div class="course-thumbnail-placeholder">
                                        <i class="fas fa-book"></i>
                                        <span>دوره آموزشی</span>
                                    </div>
                                }
                                <div class="course-status">
                                    @if (enrollment.IsCompleted)
                                    {
                                        <span class="badge bg-success">تکمیل شده</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-primary">در حال انجام</span>
                                    }
                                </div>
                                
                                <!-- Course Action Buttons in Header -->
                                <div class="course-header-actions">
                                    <button type="button" class="course-header-btn btn-study-header" 
                                            onclick="window.location.href='@Url.Action("Study", new { id = enrollment.CourseId })'"
                                            title="شروع مطالعه">
                                        <i class="fas fa-play"></i>
                                    </button>
                                    <button type="button" class="course-header-btn btn-details-header" 
                                            onclick="showCourseDetails(@enrollment.CourseId)"
                                            title="جزئیات دوره">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                    <button type="button" class="course-header-btn btn-unenroll-header" 
                                            data-action="unenroll" data-course-id="@enrollment.CourseId"
                                            title="خروج از دوره">
                                        <i class="fas fa-sign-out-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="course-content">
                                <h5 class="course-title">@enrollment.CourseTitle</h5>
                                @if (!string.IsNullOrEmpty(enrollment.CourseDescription))
                                {
                                    <p class="course-description">@enrollment.CourseDescription</p>
                                }
                                
                                <div class="course-progress">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="progress-label">پیشرفت</span>
                                        <span class="progress-percentage">@enrollment.ProgressPercentage%</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: @enrollment.ProgressPercentage%" 
                                             aria-valuenow="@enrollment.ProgressPercentage" aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>

                                <div class="course-stats">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <div class="stat-number">@enrollment.CompletedLessons</div>
                                            <div class="stat-label">درس تکمیل شده</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="stat-number">@enrollment.CompletedExams</div>
                                            <div class="stat-label">آزمون انجام شده</div>
                                        </div>
                                        <div class="col-4">
                                            <div class="stat-number">@enrollment.AverageScore.ToString("F1")</div>
                                            <div class="stat-label">میانگین نمره</div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <div class="empty-state">
                    <i class="fas fa-book"></i>
                    <h4>هنوز در دوره‌ای ثبت‌نام نکرده‌اید</h4>
                    <p>برای شروع یادگیری، در یکی از دوره‌های موجود ثبت‌نام کنید</p>
                    <a asp-action="Catalog" class="btn-continue">
                        <i class="fas fa-search me-2"></i>مشاهده کاتالوگ دوره‌ها
                    </a>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize bottom navigation
            if (window.bottomNavigation) {
                window.bottomNavigation.setActivePage('my-courses');
            }
        });
    </script>
}
