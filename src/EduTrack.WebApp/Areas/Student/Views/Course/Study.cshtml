@using EduTrack.Application.Common.Models.Courses
@using EduTrack.Application.Common.Models.TeachingPlans
@model CourseDto
@{
    ViewData["Title"] = $"مطالعه: {Model.Title}";
}

@section Styles {
    <link rel="stylesheet" href="~/css/areas/student/course/study-page.css" asp-append-version="true" />
}

<!-- Breadcrumb Navigation -->
<nav aria-label="breadcrumb" class="study-breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a asp-area="Student" asp-controller="Home" asp-action="Index">
                <i class="fas fa-home me-1"></i>خانه
            </a>
        </li>
        <li class="breadcrumb-item">
            <a asp-action="Index">
                <i class="fas fa-book-open me-1"></i>دوره‌های من
            </a>
        </li>
        <li class="breadcrumb-item">
            <a asp-action="Details" asp-route-id="@Model.Id">
                <i class="fas fa-info-circle me-1"></i>@Model.Title
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            <i class="fas fa-play me-1"></i>مطالعه
        </li>
    </ol>
</nav>

<!-- Minimal Page Header -->
<div class="study-page-header-minimal">
    <div class="study-header-content-minimal">
        <div class="course-title-minimal">
            <h1 class="study-course-title-minimal">@Model.Title</h1>
        </div>
        <div class="header-actions-minimal">
            <!-- Minimal Progress Chart -->
            <div class="minimal-progress-chart" data-bs-toggle="modal" data-bs-target="#progressModal">
                <div class="progress-circle-minimal" style="--progress: @(ViewBag.Enrollment?.ProgressPercentage ?? 0)">
                    <span class="progress-percentage-minimal">@(ViewBag.Enrollment?.ProgressPercentage ?? 0)%</span>
                </div>
            </div>
            <a asp-action="Details" asp-route-id="@Model.Id" class="btn-icon-minimal" title="جزئیات دوره">
                <i class="fas fa-info-circle"></i>
            </a>
            <a asp-action="Index" class="btn-icon-minimal" title="دوره‌های من">
                <i class="fas fa-list"></i>
            </a>
        </div>
    </div>
</div>

<!-- Progress Modal -->
<div class="modal fade" id="progressModal" tabindex="-1" aria-labelledby="progressModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="progressModalLabel">
                    <i class="fas fa-chart-line me-2"></i>جزئیات پیشرفت دوره
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="progress-details">
                    <div class="progress-summary-card">
                        <div class="progress-circle-large" style="--progress: @(ViewBag.Enrollment?.ProgressPercentage ?? 0)">
                            <span class="progress-percentage-large">@(ViewBag.Enrollment?.ProgressPercentage ?? 0)%</span>
                        </div>
                        <div class="progress-info">
                            <h6 class="progress-title">پیشرفت کلی دوره</h6>
                            <p class="progress-description">@(ViewBag.Enrollment?.ProgressPercentage ?? 0) درصد از دوره تکمیل شده است</p>
                        </div>
                    </div>
                    
                    <div class="progress-stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">تاریخ ثبت‌نام</span>
                                <span class="stat-value">@(ViewBag.Enrollment?.EnrolledAt.ToString("yyyy/MM/dd") ?? "")</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">آخرین بازدید</span>
                                <span class="stat-value">@(ViewBag.Enrollment?.LastAccessedAt?.ToString("yyyy/MM/dd") ?? "هیچ‌گاه")</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">تکالیف تکمیل شده</span>
                                <span class="stat-value" id="completed-tasks">0</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">میانگین نمرات</span>
                                <span class="stat-value" id="average-score">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Area -->
<div class="study-content-container">
    <!-- Compact Content Filter -->
    <div class="content-filter-compact">
        <div class="filter-header-compact">
            <div class="filter-info">
                <span class="filter-count" id="content-count">0</span>
                <span class="filter-label">محتوا</span>
            </div>
            <button class="refresh-icon-minimal" id="refresh-content" title="به‌روزرسانی">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
        <div class="content-type-badges-compact" id="content-type-badges">
            <!-- Dynamic filter badges will be generated here -->
        </div>
    </div>

    <!-- Schedule Items List -->
    <div class="schedule-items-container">
        <div class="schedule-items-list" id="schedule-items-list">
            <div class="loading-placeholder">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">در حال بارگذاری...</span>
                </div>
                <p class="loading-text">در حال بارگذاری محتوای آموزشی...</p>
            </div>
        </div>
        
    </div>
</div>

@section Scripts {
    <script>
        // Configuration for study page
        window.studyPageConfig = {
            getScheduleItemsUrl: '@Url.Action("GetScheduleItems", new { id = Model.Id })'
        };
    </script>
    <script src="~/js/areas/student/course/study-page.js" asp-append-version="true"></script>
}
