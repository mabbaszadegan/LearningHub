@model object
@using EduTrack.Application.Common.Models.ScheduleItems
@{
    var content = Model as OrderingContent;
    var direction = "vertical";
    var directionClass = "ordering-vertical";
    
    if (content?.Direction != null)
    {
        var dirLower = content.Direction.ToLower();
        if (dirLower == "horizontal-ltr" || dirLower == "horizontal-rtl")
        {
            direction = dirLower;
            directionClass = "ordering-horizontal";
        }
        else if (dirLower == "horizontal")
        {
            // Backward compatibility: treat old "horizontal" as "horizontal-ltr"
            direction = "horizontal-ltr";
            directionClass = "ordering-horizontal";
        }
        else
        {
            direction = "vertical";
            directionClass = "ordering-vertical";
        }
    }
}

<div class="ordering-content-container">
    @if (content != null && content.Items.Any())
    {
        var includedCount = content.Items.Count(i => i.Include);
        var allItems = content.Items.OrderBy(_ => Guid.NewGuid()).ToList();


        @if (!string.IsNullOrWhiteSpace(content.Instruction))
        {
            <div class="ordering-instruction-minimal">
                <p>@content.Instruction</p>
            </div>
        }

        <div class="sorting-block" data-direction="@direction" data-allow-dnd="@content.AllowDragDrop.ToString().ToLower()" data-show-numbers="@content.ShowNumbers.ToString().ToLower()">
            <div class="sorting-pool" id="sortingPool" aria-label="لیست آیتم‌ها" role="list">
                @foreach (var item in allItems)
                {
                    <div class="sorting-item" role="listitem" data-id="@item.Id" data-type="@item.Type" tabindex="0">
                        <span class="sorting-grip" aria-hidden="true"><i class="fas fa-grip-vertical"></i></span>
                        @if (string.Equals(item.Type, "text", System.StringComparison.OrdinalIgnoreCase))
                        {
                            <span class="sorting-text">@item.Value</span>
                        }
                        else if (string.Equals(item.Type, "image", System.StringComparison.OrdinalIgnoreCase))
                        {
                            <img class="sorting-image" src="@item.FileUrl" alt="" />
                        }
                        else if (string.Equals(item.Type, "audio", System.StringComparison.OrdinalIgnoreCase))
                        {
                            <audio class="sorting-audio" controls src="@item.FileUrl"></audio>
                        }
                    </div>
                }
            </div>

            <div class="sorting-slots @("slots-" + direction)" id="sortingSlots" aria-label="فضاهای خالی" role="list">
                @for (var i = 0; i < includedCount; i++)
                {
                    var numberLabel = content.ShowNumbers ? (i + 1).ToString() : string.Empty;
                    <div class="sorting-slot" role="listitem" data-index="@i">
                        @if (content.ShowNumbers)
                        {
                            <span class="slot-number">@numberLabel</span>
                        }
                        <div class="slot-dropzone" aria-label="رها کردن آیتم"></div>
                    </div>
                }
            </div>
        </div>
    }
    else
    {
        <div class="content-empty-state">
            <i class="fas fa-info-circle"></i>
            <p>محتوای مرتب‌سازی یافت نشد.</p>
        </div>
    }
</div>


