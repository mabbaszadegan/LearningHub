@{
    ViewData["Title"] = "تنظیمات";
    var model = ViewData.Model as dynamic;
}

@section Styles {
    <link rel="stylesheet" href="~/css/areas/student/settings.css" asp-append-version="true" />
}

<div class="content-container">
    <!-- Header -->
    <div class="settings-header mb-4">
        <h4 class="settings-title">
            <i class="fas fa-cog me-2"></i>
            تنظیمات
        </h4>
        <p class="text-muted mb-0">مدیریت تنظیمات پنل دانش‌آموز</p>
    </div>

    <!-- Account Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0">
                <i class="fas fa-user me-2"></i>
                اطلاعات حساب کاربری
            </h6>
        </div>
        <div class="card-body">
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">نام کاربری</div>
                    <div class="settings-item-value">@(model?.UserName ?? "-")</div>
                </div>
            </div>
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">ایمیل</div>
                    <div class="settings-item-value">@(model?.Email ?? "-")</div>
                </div>
            </div>
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">نام و نام خانوادگی</div>
                    <div class="settings-item-value">@(model?.StudentName ?? "-")</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0">
                <i class="fas fa-bell me-2"></i>
                تنظیمات اعلان‌ها
            </h6>
        </div>
        <div class="card-body">
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">اعلان‌های ایمیل</div>
                    <div class="settings-item-description">دریافت اعلان‌ها از طریق ایمیل</div>
                </div>
                <div class="settings-item-action">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                        <label class="form-check-label" for="emailNotifications"></label>
                    </div>
                </div>
            </div>
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">اعلان‌های پوش</div>
                    <div class="settings-item-description">دریافت اعلان‌های فوری</div>
                </div>
                <div class="settings-item-action">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="pushNotifications" checked>
                        <label class="form-check-label" for="pushNotifications"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- App Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0">
                <i class="fas fa-mobile-alt me-2"></i>
                تنظیمات اپلیکیشن
            </h6>
        </div>
        <div class="card-body">
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">حالت تاریک</div>
                    <div class="settings-item-description">فعال‌سازی تم تاریک</div>
                </div>
                <div class="settings-item-action">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="darkMode">
                        <label class="form-check-label" for="darkMode"></label>
                    </div>
                </div>
            </div>
            <div class="settings-item">
                <div class="settings-item-content">
                    <div class="settings-item-label">ذخیره خودکار</div>
                    <div class="settings-item-description">ذخیره خودکار پیشرفت</div>
                </div>
                <div class="settings-item-action">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoSave" checked>
                        <label class="form-check-label" for="autoSave"></label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="settings-actions">
                <button type="button" class="btn btn-primary w-100 mb-3" id="saveSettings">
                    <i class="fas fa-save me-2"></i>
                    ذخیره تنظیمات
                </button>
                <a href="@Url.Action("Index", "Profile")" class="btn btn-outline-primary w-100">
                    <i class="fas fa-user-edit me-2"></i>
                    ویرایش پروفایل
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize bottom navigation
            if (window.bottomNavigation) {
                window.bottomNavigation.setActivePage('settings');
            }

            // Save settings
            $('#saveSettings').on('click', function() {
                const emailNotifications = $('#emailNotifications').is(':checked');
                const pushNotifications = $('#pushNotifications').is(':checked');

                $.ajax({
                    url: '@Url.Action("UpdateNotificationSettings")',
                    type: 'POST',
                    data: {
                        emailNotifications: emailNotifications,
                        pushNotifications: pushNotifications,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            toastr.success(response.message || 'تنظیمات با موفقیت ذخیره شد');
                        } else {
                            toastr.error(response.error || 'خطا در ذخیره تنظیمات');
                        }
                    },
                    error: function() {
                        toastr.error('خطا در ذخیره تنظیمات');
                    }
                });
            });
        });
    </script>
}

