@model EduTrack.Application.Common.Models.DashboardViewModel
@{
    ViewData["Title"] = "داشبورد اصلی";
}

<!-- Welcome Header -->
<div class="dashboard-header bg-gradient-primary text-white py-4 mb-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center">
                    <div class="dashboard-avatar me-3">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div>
                        <h1 class="h3 mb-1">خوش آمدید به داشبورد EduTrack</h1>
                        <p class="mb-0 opacity-75">سیستم مدیریت یادگیری هوشمند و مدرن</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-end">
                <div class="dashboard-time">
                    <div class="time-display" id="currentTime"></div>
                    <div class="date-display" id="currentDate"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Enhanced Stats Section -->
    <div class="row mb-5">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card enhanced">
                <div class="stats-card-header">
                    <div class="dashboard-card-icon primary">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stats-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12%</span>
                    </div>
                </div>
                <div class="stats-content">
                    <div class="stats-number">@Model.TotalCourses</div>
                    <div class="stats-label">دوره فعال</div>
                    <div class="stats-description">دوره‌های در دسترس</div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card enhanced">
                <div class="stats-card-header">
                    <div class="dashboard-card-icon success">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="stats-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+8%</span>
                    </div>
                </div>
                <div class="stats-content">
                    <div class="stats-number">@Model.TotalLessons</div>
                    <div class="stats-label">درس موجود</div>
                    <div class="stats-description">درس‌های آموزشی</div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card enhanced">
                <div class="stats-card-header">
                    <div class="dashboard-card-icon warning">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stats-trend neutral">
                        <i class="fas fa-minus"></i>
                        <span>0%</span>
                    </div>
                </div>
                <div class="stats-content">
                    <div class="stats-number">@Model.TotalModules</div>
                    <div class="stats-label">ماژول آموزشی</div>
                    <div class="stats-description">بخش‌های آموزشی</div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="stats-card enhanced">
                <div class="stats-card-header">
                    <div class="dashboard-card-icon info">
                        <i class="fas fa-wifi"></i>
                    </div>
                    <div class="stats-trend positive">
                        <i class="fas fa-check"></i>
                        <span>100%</span>
                    </div>
                </div>
                <div class="stats-content">
                    <div class="stats-number">آنلاین</div>
                    <div class="stats-label">وضعیت سیستم</div>
                    <div class="stats-description">سیستم فعال</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="row">
        <!-- Left Column - Main Content -->
        <div class="col-lg-8">
            <!-- Quick Actions Panel -->
            <div class="dashboard-panel mb-4">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-bolt me-2"></i>دسترسی سریع
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <a asp-controller="Catalog" asp-action="Index" class="quick-action-card">
                                <div class="quick-action-icon primary">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="quick-action-text">دوره‌ها</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a asp-controller="Exam" asp-action="Index" class="quick-action-card">
                                <div class="quick-action-icon success">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <div class="quick-action-text">آزمون‌ها</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a asp-controller="Classroom" asp-action="Index" class="quick-action-card">
                                <div class="quick-action-icon warning">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="quick-action-text">کلاس‌ها</div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <a asp-controller="Progress" asp-action="Index" class="quick-action-card">
                                <div class="quick-action-icon info">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="quick-action-text">پیشرفت</div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Courses Section -->
            <div class="dashboard-panel mb-4">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-graduation-cap me-2"></i>دوره‌های موجود
                    </h3>
                    <a asp-controller="Catalog" asp-action="Index" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-eye me-1"></i>مشاهده همه
                    </a>
                </div>
                <div class="panel-body">
            
                    @if (Model.Courses.Items.Any())
                    {
                        <div class="row g-3">
                            @foreach (var course in Model.Courses.Items.Take(6))
                            {
                                <div class="col-md-6">
                                    <div class="course-card enhanced">
                                        <div class="course-card-header">
                                            <div class="course-card-image">
                                                <i class="fas fa-graduation-cap"></i>
                                            </div>
                                            <div class="course-status-badge">
                                                <span class="badge badge-success">فعال</span>
                                            </div>
                                        </div>
                                        <div class="course-card-content">
                                            <h4 class="course-title">@course.Title</h4>
                                            <p class="course-description">@course.Description</p>
                                            <div class="course-progress">
                                                <div class="progress">
                                                    <div class="progress-bar" style="width: 0%"></div>
                                                </div>
                                                <small class="text-muted">0% تکمیل شده</small>
                                            </div>
                                            <div class="course-stats">
                                                <div class="course-stat">
                                                    <div class="course-stat-number">@course.ModuleCount</div>
                                                    <div class="course-stat-label">ماژول</div>
                                                </div>
                                                <div class="course-stat">
                                                    <div class="course-stat-number">@course.LessonCount</div>
                                                    <div class="course-stat-label">درس</div>
                                                </div>
                                                <div class="course-stat">
                                                    <a asp-controller="Catalog" asp-action="Details" asp-route-id="@course.Id" class="btn btn-primary btn-sm">
                                                        <i class="fas fa-arrow-left me-1"></i>مشاهده
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <h4 class="empty-state-title">هیچ دوره‌ای موجود نیست</h4>
                            <p class="empty-state-description">در حال حاضر هیچ دوره‌ای در دسترس نیست. لطفاً بعداً بررسی کنید یا با مدیر سیستم تماس بگیرید.</p>
                            <a asp-controller="Catalog" asp-action="Index" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>مشاهده همه دوره‌ها
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar -->
        <div class="col-lg-4">
            <!-- User Progress Summary -->
            <div class="dashboard-panel mb-4">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-chart-pie me-2"></i>خلاصه پیشرفت
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="progress-summary">
                        <div class="progress-item">
                            <div class="progress-info">
                                <div class="progress-label">دوره‌های تکمیل شده</div>
                                <div class="progress-value">@Model.CompletedCourses از @Model.TotalCourses</div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: @(Model.TotalCourses > 0 ? (Model.CompletedCourses * 100 / Model.TotalCourses) : 0)%"></div>
                            </div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-info">
                                <div class="progress-label">درس‌های مطالعه شده</div>
                                <div class="progress-value">@Model.CompletedLessons از @Model.TotalLessons</div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: @(Model.TotalLessons > 0 ? (Model.CompletedLessons * 100 / Model.TotalLessons) : 0)%"></div>
                            </div>
                        </div>
                        <div class="progress-item">
                            <div class="progress-info">
                                <div class="progress-label">آزمون‌های پاس شده</div>
                                <div class="progress-value">@Model.CompletedExams از @Model.RecentExams.TotalCount</div>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: @(Model.RecentExams.TotalCount > 0 ? (Model.CompletedExams * 100 / Model.RecentExams.TotalCount) : 0)%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="dashboard-panel mb-4">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-server me-2"></i>وضعیت سیستم
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="status-list">
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-wifi"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">حالت آنلاین</div>
                                <div class="status-value">فعال</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">پایگاه داده</div>
                                <div class="status-value">SQLite</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">امنیت</div>
                                <div class="status-value">فعال</div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-cloud"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">ذخیره‌سازی</div>
                                <div class="status-value">محلی</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="dashboard-panel mb-4">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-clock me-2"></i>فعالیت‌های اخیر
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="activity-timeline">
                        <div class="activity-item">
                            <div class="activity-icon primary">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">دوره جدید اضافه شد</div>
                                <div class="activity-time">2 ساعت پیش</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">آزمون تکمیل شد</div>
                                <div class="activity-time">1 روز پیش</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon warning">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">کاربر جدید ثبت نام کرد</div>
                                <div class="activity-time">3 روز پیش</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon info">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">فایل جدید آپلود شد</div>
                                <div class="activity-time">1 هفته پیش</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="dashboard-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-link me-2"></i>لینک‌های مفید
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="quick-links">
                        <a href="#" class="quick-link">
                            <i class="fas fa-question-circle me-2"></i>راهنمای استفاده
                        </a>
                        <a href="#" class="quick-link">
                            <i class="fas fa-headset me-2"></i>پشتیبانی فنی
                        </a>
                        <a href="#" class="quick-link">
                            <i class="fas fa-cog me-2"></i>تنظیمات حساب
                        </a>
                        <a href="#" class="quick-link">
                            <i class="fas fa-download me-2"></i>دانلود اپلیکیشن
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <!-- Dashboard styles are now loaded from external CSS files -->
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Update time and date with enhanced formatting
            function updateDateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                const dateString = now.toLocaleDateString('fa-IR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                $('#currentTime').text(timeString);
                $('#currentDate').text(dateString);
            }
            
            // Update time every second
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Enhanced stats cards animation with staggered effect
            $('.stats-card').each(function(index) {
                $(this).css('animation-delay', (index * 0.15) + 's');
                $(this).addClass('animate-fade-in-up');
                
                // Add hover sound effect simulation
                $(this).hover(
                    function() {
                        $(this).find('.dashboard-card-icon').addClass('animate-bounce-in');
                    },
                    function() {
                        $(this).find('.dashboard-card-icon').removeClass('animate-bounce-in');
                    }
                );
            });
            
            // Enhanced course cards with better animations
            $('.course-card').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
                $(this).addClass('animate-fade-in-up');
                
                // Enhanced hover effects
                $(this).hover(
                    function() {
                        $(this).find('.course-card-image').css('transform', 'scale(1.05) rotate(2deg)');
                        $(this).find('.course-status-badge .badge').addClass('animate-bounce-in');
                    },
                    function() {
                        $(this).find('.course-card-image').css('transform', 'scale(1) rotate(0deg)');
                        $(this).find('.course-status-badge .badge').removeClass('animate-bounce-in');
                    }
                );
            });
            
            // Enhanced quick action cards with ripple effect
            $('.quick-action-card').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
                $(this).addClass('animate-slide-in-right');
                
                // Add ripple effect on click
                $(this).click(function(e) {
                    const $card = $(this);
                    const $ripple = $('<div class="ripple-effect"></div>');
                    
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;
                    
                    $ripple.css({
                        width: size,
                        height: size,
                        left: x,
                        top: y
                    });
                    
                    $card.append($ripple);
                    
                    setTimeout(() => {
                        $ripple.remove();
                    }, 600);
                });
            });
            
            // Enhanced dashboard panels animation
            $('.dashboard-panel').each(function(index) {
                $(this).css('animation-delay', (index * 0.2) + 's');
                $(this).addClass('animate-fade-in-up');
            });
            
            // Enhanced progress bars with smooth animation
            $('.progress-bar').each(function() {
                const $bar = $(this);
                const width = $bar.data('width') || $bar.css('width');
                $bar.css('width', '0%');
                
                setTimeout(() => {
                    $bar.css('width', width);
                }, 800 + Math.random() * 500);
            });
            
            // Enhanced button loading animation
            $('.btn').click(function() {
                const $btn = $(this);
                const originalText = $btn.html();
                const $loadingIcon = $('<i class="fas fa-spinner fa-spin me-2"></i>');
                
                $btn.prop('disabled', true);
                $btn.html($loadingIcon.prop('outerHTML') + 'در حال بارگذاری...');
                $btn.addClass('btn-loading');
                
                setTimeout(() => {
                    $btn.prop('disabled', false);
                    $btn.html(originalText);
                    $btn.removeClass('btn-loading');
                }, 2000);
            });
            
            // Enhanced status items animation
            $('.status-item').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
                $(this).addClass('animate-slide-in-right');
            });
            
            // Enhanced activity timeline animation
            $('.activity-item').each(function(index) {
                $(this).css('animation-delay', (index * 0.1) + 's');
                $(this).addClass('animate-slide-in-right');
            });
            
            // Enhanced quick links animation
            $('.quick-link').each(function(index) {
                $(this).css('animation-delay', (index * 0.05) + 's');
                $(this).addClass('animate-slide-in-right');
            });
            
            // Add parallax effect to dashboard header
            $(window).scroll(function() {
                const scrolled = $(window).scrollTop();
                const parallax = scrolled * 0.5;
                $('.dashboard-header').css('transform', `translateY(${parallax}px)`);
            });
            
            // Add intersection observer for scroll animations
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animate-fade-in-up');
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                });
                
                document.querySelectorAll('.stats-card, .course-card, .dashboard-panel').forEach(el => {
                    observer.observe(el);
                });
            }
            
            // Add smooth scroll behavior
            $('a[href^="#"]').click(function(e) {
                e.preventDefault();
                const target = $(this.getAttribute('href'));
                if (target.length) {
                    $('html, body').animate({
                        scrollTop: target.offset().top - 100
                    }, 800, 'easeInOutCubic');
                }
            });
            
            // Add keyboard navigation support
            $(document).keydown(function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.which) {
                        case 49: // Ctrl+1
                            e.preventDefault();
                            $('.quick-action-card').first().click();
                            break;
                        case 50: // Ctrl+2
                            e.preventDefault();
                            $('.quick-action-card').eq(1).click();
                            break;
                        case 51: // Ctrl+3
                            e.preventDefault();
                            $('.quick-action-card').eq(2).click();
                            break;
                        case 52: // Ctrl+4
                            e.preventDefault();
                            $('.quick-action-card').eq(3).click();
                            break;
                    }
                }
            });
            
            // Add tooltip functionality
            $('[data-tooltip]').hover(
                function() {
                    const tooltip = $(this).data('tooltip');
                    $(this).append(`<div class="custom-tooltip">${tooltip}</div>`);
                },
                function() {
                    $(this).find('.custom-tooltip').remove();
                }
            );
            
            // Add theme toggle functionality (if needed)
            $('.theme-toggle').click(function() {
                $('body').toggleClass('dark-theme');
                localStorage.setItem('theme', $('body').hasClass('dark-theme') ? 'dark' : 'light');
            });
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                $('body').addClass('dark-theme');
            }
        });
    </script>
    
    <!-- Additional styles are now loaded from external CSS files -->
}